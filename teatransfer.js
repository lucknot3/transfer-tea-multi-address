require("dotenv").config();const fs=require("fs"),axios=require("axios"),path=require("path"),{ethers}=require("ethers");const RPC_URL=process.env.RPC_URL;if(!RPC_URL||!process.env.PRIVATE_KEY_1||!process.env.TOKEN_ADDRESS_1){console.error("âŒ ERROR: Pastikan file .env dikonfigurasi dengan benar.");process.exit(1)}const provider=new ethers.JsonRpcProvider(RPC_URL,{chainId:10218,name:"tea-sepolia"}),PRIVATE_KEYS=[process.env.PRIVATE_KEY_1,process.env.PRIVATE_KEY_2,process.env.PRIVATE_KEY_3],TOKEN_ADDRESSES=[process.env.TOKEN_ADDRESS_1,process.env.TOKEN_ADDRESS_2,process.env.TOKEN_ADDRESS_3],TELEGRAM_BOT_TOKEN=process.env.TELEGRAM_BOT_TOKEN,TELEGRAM_CHAT_ID=process.env.TELEGRAM_CHAT_ID;const logDir=path.join(__dirname,"logs");if(!fs.existsSync(logDir))fs.mkdirSync(logDir);const logFile=path.join(logDir,`log-${new Date().toISOString().split("T")[0]}.txt`),logStream=fs.createWriteStream(logFile,{flags:"a"});function logMessage(e,t){const o=`[${new Date().toISOString()}] [${e}] ${t}\n`;logStream.write(o),console.log(o)}function sendTelegramMessage(e){if(!TELEGRAM_BOT_TOKEN||!TELEGRAM_CHAT_ID)return;axios.post(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`,{chat_id:TELEGRAM_CHAT_ID,text:e,parse_mode:"Markdown"}).catch(e=>console.error("Gagal kirim ke Telegram:",e.message))}function logInfo(e){logMessage("INFO",e),/Transaksi/.test(e)&&sendTelegramMessage(e)}function logError(e){logMessage("ERROR",e),sendTelegramMessage(`âŒ *Error:* ${e}`)}function readAddressesFromFile(e){return fs.existsSync(e)?fs.readFileSync(e,"utf8").split("\n").map(e=>e.trim().toLowerCase()).filter(Boolean):[]}function writeAddressesToFile(e,t){fs.writeFileSync(e,[...new Set(t)].join("\n"),"utf8")}async function fetchKYCAddresses(){try{return logInfo("â¬‡ï¸ Mengunduh daftar alamat KYC..."),(await axios.get("https://raw.githubusercontent.com/clwkevin/LayerOS/main/addressteasepoliakyc.txt")).data.split("\n").map(e=>e.trim().toLowerCase()).filter(Boolean)}catch(e){return logError("âŒ Gagal ambil data KYC: "+e.message),[]}}function getWalletAndTokenContract(e,t){const o=new ethers.Wallet(e,provider),r=new ethers.Contract(t,["function transfer(address to, uint256 amount) public returns (bool)","function decimals() view returns (uint8)"],o);return{wallet:o,tokenContract:r}}function delay(e){return new Promise(t=>setTimeout(t,e))}function randomDelay(e,t){return Math.floor(Math.random()*(t-e+1))+e}async function distributeTokens(){try{const e=await fetchKYCAddresses();if(0===e.length)return;let t=readAddressesFromFile("kyc_addresses_sent.txt"),o=readAddressesFromFile("kyc_addresses_pending.txt"),r=e.filter(e=>!t.includes(e)||o.includes(e));if(writeAddressesToFile("kyc_addresses_pending.txt",[]),0===r.length)return void logInfo("âœ… Semua alamat KYC sudah menerima token.");const a=Math.min(r.length,Math.floor(100+Math.random()*10)+1);logInfo(`ðŸŽ¯ Akan kirim ${a} transaksi hari ini.`);const n=r.slice(0,a).sort(()=>.5-Math.random()),s=[],i=ethers.parseUnits("1000.0",18);let c=1;for(const l of n){const e=randomDelay(6e4,18e4);logInfo(`âŒ› Delay ${Math.floor(e/1e3)}s sebelum kirim ke ${l}`),await delay(e);try{for(let e=0;e<3;e++){const{wallet:r,tokenContract:a}=getWalletAndTokenContract(PRIVATE_KEYS[e],TOKEN_ADDRESSES[e]);logInfo(`ðŸš€ TX #${c} - Kirim ke ${l} dari ${r.address}`);const n=await a.transfer(l,i);await n.wait(3);const s=`âœ… *[TX #${c}]* Berhasil\n*Dari:* \`${r.address}\`\n*Ke:* \`${l}\`\n*Token:* \`${TOKEN_ADDRESSES[e]}\`\n[ðŸ”— TX Hash](https://sepolia.tea.xyz/tx/${n.hash})`;logInfo(s),sendTelegramMessage(s),t.push(l),writeAddressesToFile("kyc_addresses_sent.txt",t),await delay(randomDelay(3e4,7e4)),c++}}catch(e){const t=`âŒ *[TX #${c}]* GAGAL\n*Ke:* \`${l}\`\n*Error:* \`${e.message}\``;logError(t),s.push(l),c++}}writeAddressesToFile("kyc_addresses_pending.txt",s),logInfo(`ðŸ“¦ Distribusi selesai. Sukses: ${a-s.length}, Gagal: ${s.length}`)}catch(e){logError("âŒ Error distribusi utama: "+e.message)}}async function startDailyLoop(){for(;;){await distributeTokens();const e=new Date,t=new Date;t.setUTCHours(0,0,0,0),t.setUTCDate(e.getUTCDate()+1);const o=t-e;logInfo(`âœ… Selesai untuk hari ini. Menunggu hingga ${t.toISOString()}...\n`),await delay(o+Math.floor(180e3*Math.random()))}}startDailyLoop();

